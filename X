
> mapcap-ipo-backend@1.6.2 test
> node --experimental-vm-modules node_modules/.bin/jest

(node:27352) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL test/unit/package_integrity.test.js
  ‚óè Package Integrity - Production Readiness Tests ‚Ä∫ Metadata: Should have the correct name and stabilized version

    expect(received).toBe(expected) // Object.is equality

    Expected: "1.6.1"
    Received: "1.6.2"

      24 |   test('Metadata: Should have the correct name and stabilized version', () => {
      25 |     expect(pkg.name).toBe('mapcap-ipo-backend');
    > 26 |     expect(pkg.version).toBe('1.6.1');
         |                         ^
      27 |     expect(pkg.type).toBe('module'); // Critical for ES6 imports
      28 |   });
      29 |

      at Object.toBe (test/unit/package_integrity.test.js:26:25)

(node:27346) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL test/unit/logger.test.js
  ‚óè Audit Logger Engine - Unit Tests ‚Ä∫ Environment: Should verify logger synchronization message on boot

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "MapCap Audit Engine Synchronized"

    Number of calls: 0

      68 |   test('Environment: Should verify logger synchronization message on boot', () => {
      69 |     // Verification of the initialization log captured during import
    > 70 |     expect(logSpy).toHaveBeenCalledWith(
         |                    ^
      71 |       expect.stringContaining('MapCap Audit Engine Synchronized')
      72 |     );
      73 |   });

      at Object.toHaveBeenCalledWith (test/unit/logger.test.js:70:20)

(node:27339) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL test/unit/settlement_logic.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:34.771Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [COMPLIANCE] Starting Final Whale Settlement & Refund Cycle ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:34.911Z - [INFO]: Whale Settlement Initiated. Pool: 100000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_001 | Excess: 5000.555555 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.executeWhaleTrimBack (test/unit/settlement_logic.test.js:57:40)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:34.924Z - [INFO]: Settlement Success: 5000.555555 Pi refunded to Whale_001. Capped at 10%.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUMMARY] Settlement Complete. Total Recovered: 5000.555555 Pi | Whales Impacted: 1 ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:84:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:34.927Z - [INFO]: Settlement Complete. Total Recovered: 5000.555555 Pi | Whales Impacted: 1
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [COMPLIANCE] Starting Final Whale Settlement & Refund Cycle ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:35.009Z - [INFO]: Whale Settlement Initiated. Pool: 100000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_A | Excess: 10000 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.executeWhaleTrimBack (test/unit/settlement_logic.test.js:88:25)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:35.014Z - [CRITICAL]: SETTLEMENT_FAILURE for Whale_A: A2U Pipeline Timeout
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at SettlementJob.writeAuditLog [as executeWhaleTrimBack] (src/jobs/settlement.job.js:75:21)
      at Object.<anonymous> (test/unit/settlement_logic.test.js:88:5)

    console.error
      [CRITICAL_SETTLEMENT_FAILURE] A2U Pipeline Timeout

      74 |                      */
      75 |                     writeAuditLog('CRITICAL', `SETTLEMENT_FAILURE for ${investor.piAddress}: ${error.message}`);
    > 76 |                     console.error(`[CRITICAL_SETTLEMENT_FAILURE]`, error.message);
         |                             ^
      77 |                 }
      78 |             }
      79 |         }

      at SettlementJob.error [as executeWhaleTrimBack] (src/jobs/settlement.job.js:76:29)
      at Object.<anonymous> (test/unit/settlement_logic.test.js:88:5)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_B | Excess: 10000 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.<anonymous> (test/unit/settlement_logic.test.js:88:5)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:35.016Z - [INFO]: Settlement Success: 10000 Pi refunded to Whale_B. Capped at 10%.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUMMARY] Settlement Complete. Total Recovered: 10000 Pi | Whales Impacted: 1 ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:84:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:35.018Z - [INFO]: Settlement Complete. Total Recovered: 10000 Pi | Whales Impacted: 1
      [0m

      at log (src/config/logger.js:58:17)

  ‚óè Settlement Job - Anti-Whale Logic Tests ‚Ä∫ Enforcement: Should identify whales and calculate excess Pi with 6-decimal precision

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Whale_001", 5000.555556
    Received: "Whale_001", 5000.555555

    Number of calls: 1

      62 |     // 2. Verify precise refund calculation using the core MathHelper
      63 |     const expectedRefund = MathHelper.toPiPrecision(5000.5555555);
    > 64 |     expect(PayoutService.executeA2UPayout).toHaveBeenCalledWith('Whale_001', expectedRefund);
         |                                            ^
      65 |
      66 |     // 3. Verify Database Update & Whale Status Flag
      67 |     expect(mockInvestors[0].totalPiContributed).toBe(threshold);

      at Object.toHaveBeenCalledWith (test/unit/settlement_logic.test.js:64:44)

(node:27333) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL test/unit/transaction_model.test.js (5.678 s)
  ‚óè Transaction Model - Ledger Integrity Tests ‚Ä∫ Defaults: Should default to COMPLETED status for ledger consistency

    expect(received).toBe(expected) // Object.is equality

    Expected: "COMPLETED"
    Received: "PENDING"

      56 |     });
      57 |
    > 58 |     expect(tx.status).toBe('COMPLETED');
         |                       ^
      59 |   });
      60 |
      61 |   /**

      at Object.toBe (test/unit/transaction_model.test.js:58:23)

PASS test/unit/vesting_job.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.427Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      üïí --- [VESTING_ENGINE] Monthly Distribution Cycle Started ---

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.489Z - [INFO]: Vesting Engine: Monthly Tranche Release Initiated.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      üìä [SCAN] Found 1 eligible Pioneers for distribution.

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:46:21)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.497Z - [INFO]: [TRANCHE_RELEASED] 1/10 | Recipient: Pioneer_001
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      ‚úÖ [SUCCESS] Tranche dispatched to: Pioneer_001

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:74:33)

    console.log
      üèÅ --- [SUCCESS] Monthly Vesting Cycle Finalized ---

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:88:21)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.503Z - [INFO]: Vesting Engine: Cycle finished successfully.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      üïí --- [VESTING_ENGINE] Monthly Distribution Cycle Started ---

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.541Z - [INFO]: Vesting Engine: Monthly Tranche Release Initiated.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      ‚ÑπÔ∏è [SYSTEM] Idle State: No pending vesting tranches detected.

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:42:25)

    console.log
      üïí --- [VESTING_ENGINE] Monthly Distribution Cycle Started ---

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.559Z - [INFO]: Vesting Engine: Monthly Tranche Release Initiated.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      ‚ÑπÔ∏è [SYSTEM] Idle State: No pending vesting tranches detected.

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:42:25)

    console.log
      üïí --- [VESTING_ENGINE] Monthly Distribution Cycle Started ---

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.581Z - [INFO]: Vesting Engine: Monthly Tranche Release Initiated.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      üìä [SCAN] Found 1 eligible Pioneers for distribution.

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:46:21)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:38.587Z - [CRITICAL]: [PAYOUT_FAILURE] Identity: Pioneer_Err | Error: Network Fail
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at VestingJob.writeAuditLog [as executeMonthlyVesting] (src/jobs/vesting.job.js:82:25)
      at Object.<anonymous> (test/unit/vesting_job.test.js:99:5)

    console.error
      ‚ùå [PIPELINE_ERROR] Payment failed for Pioneer_Err: Network Fail

      81 |                          */
      82 |                         writeAuditLog('CRITICAL', `[PAYOUT_FAILURE] Identity: ${investor.piAddress} | Error: ${err.message}`);
    > 83 |                         console.error(`‚ùå [PIPELINE_ERROR] Payment failed for ${investor.piAddress}:`, err.message);
         |                                 ^
      84 |                     }
      85 |                 }
      86 |             }

      at VestingJob.error [as executeMonthlyVesting] (src/jobs/vesting.job.js:83:33)
      at Object.<anonymous> (test/unit/vesting_job.test.js:99:5)

    console.log
      üèÅ --- [SUCCESS] Monthly Vesting Cycle Finalized ---

      at VestingJob.log [as executeMonthlyVesting] (src/jobs/vesting.job.js:88:21)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.593Z - [INFO]: Vesting Engine: Cycle finished successfully.
      [0m

      at log (src/config/logger.js:58:17)

PASS test/unit/dividend_job.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.523Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [FINANCIAL_JOB] Initiating Dividend Distribution Cycle ---

      at DividendJob.log [as distributeDividends] (src/jobs/dividend.job.js:23:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.577Z - [INFO]: Dividend Cycle Started. Total Pot: 10000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:38.581Z - [WARN]: Anti-Whale triggered for Whale_Pioneer. Capped at 1000 Pi.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at DividendJob.writeAuditLog [as distributeDividends] (src/jobs/dividend.job.js:47:21)
      at Object.<anonymous> (test/unit/dividend_job.test.js:41:5)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.583Z - [INFO]: Dividend Cycle Completed. Total Distributed: 1099.9991749999313 Pi.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUCCESS] Total Distributed in this cycle: 1099.9991749999313 Pi ---

      at DividendJob.log [as distributeDividends] (src/jobs/dividend.job.js:66:21)

    console.log
      --- [FINANCIAL_JOB] Initiating Dividend Distribution Cycle ---

      at DividendJob.log [as distributeDividends] (src/jobs/dividend.job.js:23:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.616Z - [INFO]: Dividend Cycle Started. Total Pot: 10000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:38.621Z - [WARN]: Anti-Whale triggered for Whale_Pioneer. Capped at 1000 Pi.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at DividendJob.writeAuditLog [as distributeDividends] (src/jobs/dividend.job.js:47:21)
      at Object.<anonymous> (test/unit/dividend_job.test.js:55:5)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.623Z - [INFO]: Dividend Cycle Completed. Total Distributed: 1099.9991749999313 Pi.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUCCESS] Total Distributed in this cycle: 1099.9991749999313 Pi ---

      at DividendJob.log [as distributeDividends] (src/jobs/dividend.job.js:66:21)

    console.log
      --- [FINANCIAL_JOB] Initiating Dividend Distribution Cycle ---

      at DividendJob.log [as distributeDividends] (src/jobs/dividend.job.js:23:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.641Z - [INFO]: Dividend Cycle Started. Total Pot: 10000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:38.645Z - [CRITICAL]: Payment failed for Normal_Pioneer: Network Timeout
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at DividendJob.writeAuditLog [as distributeDividends] (src/jobs/dividend.job.js:57:25)
      at Object.<anonymous> (test/unit/dividend_job.test.js:70:5)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:38.647Z - [WARN]: Anti-Whale triggered for Whale_Pioneer. Capped at 1000 Pi.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at DividendJob.writeAuditLog [as distributeDividends] (src/jobs/dividend.job.js:47:21)
      at Object.<anonymous> (test/unit/dividend_job.test.js:70:5)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.649Z - [INFO]: Dividend Cycle Completed. Total Distributed: 1000 Pi.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUCCESS] Total Distributed in this cycle: 1000 Pi ---

      at DividendJob.log [as distributeDividends] (src/jobs/dividend.job.js:66:21)

PASS test/unit/api_routes.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.607Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:38.722Z - [ERROR]: [ERR-MLL7J4OY-4D1] Code: 400 | Message: Required: wallet_address & amount
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at error (src/routes/api.js:68:31)
      at Object.routeHandler (test/unit/api_routes.test.js:76:11)

(node:27332) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS test/unit/ipo_routes.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.650Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

PASS test/unit/cron_scheduler.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.744Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Cron Scheduler Initialized (UTC Mode) ---

      at CronScheduler.log [as init] (src/jobs/cron.scheduler.js:25:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.801Z - [INFO]: Cron Scheduler Engine Online.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Cron Scheduler Initialized (UTC Mode) ---

      at CronScheduler.log [as init] (src/jobs/cron.scheduler.js:25:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.814Z - [INFO]: Cron Scheduler Engine Online.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Cron Scheduler Initialized (UTC Mode) ---

      at CronScheduler.log [as init] (src/jobs/cron.scheduler.js:25:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.825Z - [INFO]: Cron Scheduler Engine Online.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Cron Scheduler Initialized (UTC Mode) ---

      at CronScheduler.log [as init] (src/jobs/cron.scheduler.js:25:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.831Z - [INFO]: Cron Scheduler Engine Online.
      [0m

      at log (src/config/logger.js:58:17)

PASS test/unit/admin_routes.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:41.116Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

PASS test/unit/manual_trigger.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:41.263Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

FAIL test/unit/server_heartbeat.test.js (8.939 s)
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:38.913Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      üöÄ [ENGINE] MapCap IPO Pulse deployed on port 3000

      at Server.log (server.js:137:17)

    console.log
      ‚úÖ [DATABASE] Financial Ledger: Connection Established

      at log (server.js:57:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.536Z - [INFO]: Database Connection Established.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Cron Scheduler Initialized (UTC Mode) ---

      at CronScheduler.log [as init] (src/jobs/cron.scheduler.js:25:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:40.551Z - [INFO]: Cron Scheduler Engine Online.
      [0m

      at log (src/config/logger.js:58:17)

  ‚óè Server Engine - Heartbeat & Integration Tests ‚Ä∫ Resilience: Should trigger the Global Error Interceptor on failures

    expect(received).toHaveProperty(path)

    Expected path: "success"
    Received path: []

    Received value: {}

      69 |      * Ensures the Frontend receives a consistent JSON object even on crashes.
      70 |      */
    > 71 |     expect(res.body).toHaveProperty('success');
         |                      ^
      72 |     expect(res.body.success).toBe(false); // Errors should return success: false
      73 |   });
      74 | });

      at Object.toHaveProperty (test/unit/server_heartbeat.test.js:71:22)

PASS test/unit/refunds_job.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.341Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [AUDIT] Initiating Anti-Whale Refund Sequence ---

      at log (src/jobs/refunds.job.js:28:13)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.368Z - [INFO]: Anti-Whale sequence started. Pool: 100000 Pi | Cap: 10000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Pioneer: Whale_User | Excess: 5000.0000 Pi

      39 |             const excessAmount = contribution - WHALE_CAP_LIMIT;
      40 |             
    > 41 |             console.warn(`[WHALE_DETECTED] Pioneer: ${investor.piAddress} | Excess: ${excessAmount.toFixed(4)} Pi`);
         |                     ^
      42 |             
      43 |             try {
      44 |                 /**

      at warn (src/jobs/refunds.job.js:41:21)
      at Object.runWhaleRefunds (test/unit/refunds_job.test.js:49:26)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.375Z - [INFO]: Refund Successful: 5000 Pi returned to Whale_User
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.377Z - [INFO]: Anti-Whale Refund Completed. Total Refunded: 5000 Pi across 1 accounts.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Process Finished. 1 Refunds issued. ---

      at log (src/jobs/refunds.job.js:75:13)

    console.log
      --- [AUDIT] Initiating Anti-Whale Refund Sequence ---

      at log (src/jobs/refunds.job.js:28:13)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.413Z - [INFO]: Anti-Whale sequence started. Pool: 100000 Pi | Cap: 10000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Pioneer: Whale_User | Excess: 10000.0000 Pi

      39 |             const excessAmount = contribution - WHALE_CAP_LIMIT;
      40 |             
    > 41 |             console.warn(`[WHALE_DETECTED] Pioneer: ${investor.piAddress} | Excess: ${excessAmount.toFixed(4)} Pi`);
         |                     ^
      42 |             
      43 |             try {
      44 |                 /**

      at warn (src/jobs/refunds.job.js:41:21)
      at Object.runWhaleRefunds (test/unit/refunds_job.test.js:69:11)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.420Z - [INFO]: Refund Successful: 10000 Pi returned to Whale_User
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.422Z - [INFO]: Anti-Whale Refund Completed. Total Refunded: 10000 Pi across 1 accounts.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Process Finished. 1 Refunds issued. ---

      at log (src/jobs/refunds.job.js:75:13)

    console.log
      --- [AUDIT] Initiating Anti-Whale Refund Sequence ---

      at log (src/jobs/refunds.job.js:28:13)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.439Z - [INFO]: Anti-Whale sequence started. Pool: 100000 Pi | Cap: 10000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Pioneer: Whale_1 | Excess: 10000.0000 Pi

      39 |             const excessAmount = contribution - WHALE_CAP_LIMIT;
      40 |             
    > 41 |             console.warn(`[WHALE_DETECTED] Pioneer: ${investor.piAddress} | Excess: ${excessAmount.toFixed(4)} Pi`);
         |                     ^
      42 |             
      43 |             try {
      44 |                 /**

      at warn (src/jobs/refunds.job.js:41:21)
      at Object.runWhaleRefunds (test/unit/refunds_job.test.js:90:26)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:42.446Z - [CRITICAL]: Refund FAILED for Whale_1: Network Lag
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at writeAuditLog (src/jobs/refunds.job.js:66:17)
      at Object.<anonymous> (test/unit/refunds_job.test.js:90:20)

    console.error
      [CRITICAL_AUDIT_FAILURE] Payment Pipeline Error: Network Lag

      65 |                  */
      66 |                 writeAuditLog('CRITICAL', `Refund FAILED for ${investor.piAddress}: ${error.message}`);
    > 67 |                 console.error(`[CRITICAL_AUDIT_FAILURE] Payment Pipeline Error:`, error.message);
         |                         ^
      68 |             }
      69 |         }
      70 |     }

      at error (src/jobs/refunds.job.js:67:25)
      at Object.<anonymous> (test/unit/refunds_job.test.js:90:20)

    console.warn
      [WHALE_DETECTED] Pioneer: Whale_2 | Excess: 20000.0000 Pi

      39 |             const excessAmount = contribution - WHALE_CAP_LIMIT;
      40 |             
    > 41 |             console.warn(`[WHALE_DETECTED] Pioneer: ${investor.piAddress} | Excess: ${excessAmount.toFixed(4)} Pi`);
         |                     ^
      42 |             
      43 |             try {
      44 |                 /**

      at warn (src/jobs/refunds.job.js:41:21)
      at Object.<anonymous> (test/unit/refunds_job.test.js:90:20)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.451Z - [INFO]: Refund Successful: 20000 Pi returned to Whale_2
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.453Z - [INFO]: Anti-Whale Refund Completed. Total Refunded: 20000 Pi across 1 accounts.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SYSTEM] Process Finished. 1 Refunds issued. ---

      at log (src/jobs/refunds.job.js:75:13)

PASS test/unit/seed_script.test.js
PASS test/unit/admin_controller.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:42.869Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [ADMIN_ACTION] Manual IPO Settlement triggered at 2026-02-13T18:14:42.897Z

      at AdminController.log [as triggerFinalSettlement] (src/controllers/admin/admin.controller.js:27:21)

    console.log
      [ADMIN_ACTION] Manual IPO Settlement triggered at 2026-02-13T18:14:42.966Z

      at AdminController.log [as triggerFinalSettlement] (src/controllers/admin/admin.controller.js:27:21)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:42.971Z - [ERROR]: [ERR-MLL7J7YZ-DTG] Code: 400 | Message: Settlement Aborted: No active investment liquidity detected.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at AdminController.error [as triggerFinalSettlement] (src/controllers/admin/admin.controller.js:49:39)
      at Object.<anonymous> (test/unit/admin_controller.test.js:71:5)

    console.log
      [ADMIN_ACTION] Manual IPO Settlement triggered at 2026-02-13T18:14:42.989Z

      at AdminController.log [as triggerFinalSettlement] (src/controllers/admin/admin.controller.js:27:21)

PASS test/unit/clear_db_script.test.js
PASS test/unit/daily_price_job.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:43.549Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [MARKET_ENGINE] Starting Daily Price Recalibration ---

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:23:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:43.578Z - [INFO]: [MARKET_SNAPSHOT] Pool: 100000 Pi | Spot Price: 21.818180 Pi/MapCap
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [AUDIT] Total Pool Liquidity: 100000 Pi

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:50:21)

    console.log
      [AUDIT] Recalculated Spot Price: 21.818180

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:51:21)

    console.log
      --- [SUCCESS] Daily Price Update Cycle Completed ---

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:58:21)

    console.log
      --- [MARKET_ENGINE] Starting Daily Price Recalibration ---

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:23:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:43.609Z - [INFO]: [MARKET_SNAPSHOT] Pool: 0 Pi | Spot Price: 0.000000 Pi/MapCap
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [AUDIT] Total Pool Liquidity: 0 Pi

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:50:21)

    console.log
      [AUDIT] Recalculated Spot Price: 0.000000

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:51:21)

    console.log
      --- [SUCCESS] Daily Price Update Cycle Completed ---

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:58:21)

    console.log
      --- [MARKET_ENGINE] Starting Daily Price Recalibration ---

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:23:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:43.627Z - [INFO]: [MARKET_SNAPSHOT] Pool: 100000 Pi | Spot Price: 21.818180 Pi/MapCap
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [AUDIT] Total Pool Liquidity: 100000 Pi

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:50:21)

    console.log
      [AUDIT] Recalculated Spot Price: 21.818180

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:51:21)

    console.log
      --- [SUCCESS] Daily Price Update Cycle Completed ---

      at DailyPriceJob.log [as updatePrice] (src/jobs/daily-price-update.js:58:21)

PASS test/unit/admin_model.test.js
PASS test/unit/ipo_controller.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:44.543Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [CRITICAL_CONTROLLER_ERROR]: DB_OFFLINE

      88 |
      89 |         } catch (error) {
    > 90 |             console.error(`[CRITICAL_CONTROLLER_ERROR]: ${error.message}`);
         |                     ^
      91 |             return ResponseHelper.error(res, "Dashboard Sync Failed: Financial Pipeline Offline", 500);
      92 |         }
      93 |     }

      at IpoController.error [as getScreenStats] (src/controllers/ipo.controller.js:90:21)
      at Object.<anonymous> (test/unit/ipo_controller.test.js:81:5)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:44.649Z - [ERROR]: [ERR-MLL7J99L-TCT] Code: 500 | Message: Dashboard Sync Failed: Financial Pipeline Offline
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at IpoController.error [as getScreenStats] (src/controllers/ipo.controller.js:91:35)
      at Object.<anonymous> (test/unit/ipo_controller.test.js:81:5)

PASS test/unit/transaction_model_final.test.js
PASS test/unit/reset_vesting_script.test.js
PASS test/unit/investor_model.test.js
PASS test/unit/settlement_job.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.196Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [COMPLIANCE] Starting Final Whale Settlement & Refund Cycle ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.229Z - [INFO]: Whale Settlement Initiated. Pool: 100000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_Pioneer_001 | Excess: 5000.555555 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.executeWhaleTrimBack (test/unit/settlement_job.test.js:45:40)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.239Z - [INFO]: Settlement Success: 5000.555555 Pi refunded to Whale_Pioneer_001. Capped at 10%.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUMMARY] Settlement Complete. Total Recovered: 5000.555555 Pi | Whales Impacted: 1 ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:84:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.247Z - [INFO]: Settlement Complete. Total Recovered: 5000.555555 Pi | Whales Impacted: 1
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [COMPLIANCE] Starting Final Whale Settlement & Refund Cycle ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.285Z - [INFO]: Whale Settlement Initiated. Pool: 100000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_1 | Excess: 2000 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.executeWhaleTrimBack (test/unit/settlement_job.test.js:73:40)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.290Z - [INFO]: Settlement Success: 2000 Pi refunded to Whale_1. Capped at 10%.
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_2 | Excess: 3000 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.<anonymous> (test/unit/settlement_job.test.js:73:20)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.292Z - [INFO]: Settlement Success: 3000 Pi refunded to Whale_2. Capped at 10%.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUMMARY] Settlement Complete. Total Recovered: 5000 Pi | Whales Impacted: 2 ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:84:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.294Z - [INFO]: Settlement Complete. Total Recovered: 5000 Pi | Whales Impacted: 2
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [COMPLIANCE] Starting Final Whale Settlement & Refund Cycle ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:26:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.301Z - [INFO]: Whale Settlement Initiated. Pool: 100000 Pi
      [0m

      at log (src/config/logger.js:58:17)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_A | Excess: 10000 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.executeWhaleTrimBack (test/unit/settlement_job.test.js:94:25)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:46.305Z - [CRITICAL]: SETTLEMENT_FAILURE for Whale_A: Network Congestion
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at SettlementJob.writeAuditLog [as executeWhaleTrimBack] (src/jobs/settlement.job.js:75:21)
      at Object.<anonymous> (test/unit/settlement_job.test.js:94:5)

    console.error
      [CRITICAL_SETTLEMENT_FAILURE] Network Congestion

      74 |                      */
      75 |                     writeAuditLog('CRITICAL', `SETTLEMENT_FAILURE for ${investor.piAddress}: ${error.message}`);
    > 76 |                     console.error(`[CRITICAL_SETTLEMENT_FAILURE]`, error.message);
         |                             ^
      77 |                 }
      78 |             }
      79 |         }

      at SettlementJob.error [as executeWhaleTrimBack] (src/jobs/settlement.job.js:76:29)
      at Object.<anonymous> (test/unit/settlement_job.test.js:94:5)

    console.warn
      [WHALE_DETECTED] Wallet: Whale_B | Excess: 10000 Pi

      43 |                 const preciseRefund = MathHelper.toPiPrecision(excessAmount);
      44 |
    > 45 |                 console.warn(`[WHALE_DETECTED] Wallet: ${investor.piAddress} | Excess: ${preciseRefund} Pi`);
         |                         ^
      46 |
      47 |                 try {
      48 |                     /**

      at SettlementJob.warn [as executeWhaleTrimBack] (src/jobs/settlement.job.js:45:25)
      at Object.<anonymous> (test/unit/settlement_job.test.js:94:5)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.307Z - [INFO]: Settlement Success: 10000 Pi refunded to Whale_B. Capped at 10%.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      --- [SUMMARY] Settlement Complete. Total Recovered: 10000 Pi | Whales Impacted: 1 ---

      at SettlementJob.log [as executeWhaleTrimBack] (src/jobs/settlement.job.js:84:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.309Z - [INFO]: Settlement Complete. Total Recovered: 10000 Pi | Whales Impacted: 1
      [0m

      at log (src/config/logger.js:58:17)

PASS test/unit/error_middleware.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.324Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

PASS test/unit/calculate_whales_script.test.js
PASS test/unit/payment_controller.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.777Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:46.856Z - [INFO]: Investment Processed: 100 Pi from GBV...PIONEER_ADDR (TX: TXID_9988776655)
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:47.006Z - [ERROR]: [ERR-MLL7JB32-AFE] Code: 409 | Message: Duplicate Transaction: TXID already processed.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at PaymentController.error [as processInvestment] (src/controllers/payment.controller.js:38:39)
      at Object.<anonymous> (test/unit/payment_controller.test.js:69:5)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:47.069Z - [ERROR]: [ERR-MLL7JB4T-XCH] Code: 400 | Message: Missing transaction metadata.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at PaymentController.error [as processInvestment] (src/controllers/payment.controller.js:28:35)
      at Object.processInvestment (test/unit/payment_controller.test.js:84:29)

PASS test/unit/investor_refined_model.test.js
PASS test/unit/validate_middleware.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:47.989Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:48.100Z - [ERROR]: [ERR-MLL7JBXG-RFB] Code: 400 | Message: Missing mandatory parameters: 'percentage' and 'userWallet' are required.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at error (src/middlewares/validate.middleware.js:25:31)
      at Object.validateWithdrawal (test/unit/validate_middleware.test.js:57:5)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:48.150Z - [ERROR]: [ERR-MLL7JBYU-DNN] Code: 400 | Message: Invalid range: Withdrawal percentage must be between 0.01% and 100%.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at error (src/middlewares/validate.middleware.js:38:31)
      at Object.validateWithdrawal (test/unit/validate_middleware.test.js:70:5)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:48.194Z - [ERROR]: [ERR-MLL7JC02-WU4] Code: 400 | Message: Missing mandatory parameters: 'percentage' and 'userWallet' are required.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at error (src/middlewares/validate.middleware.js:25:31)
      at Object.validateWithdrawal (test/unit/validate_middleware.test.js:85:5)

PASS test/unit/admin_auth_controller.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:48.329Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.log
      [AUTH_SUCCESS] Admin session initiated for: admin

      at AuthController.log [as adminLogin] (src/controllers/admin/auth.controller.js:43:21)

    console.warn
      [SECURITY_ALERT] Unauthorized login attempt from: admin

      54 |          * Capturing failed attempts for Daniel's audit logging and Whale-Shield defense.
      55 |          */
    > 56 |         console.warn(`[SECURITY_ALERT] Unauthorized login attempt from: ${username}`);
         |                 ^
      57 |         
      58 |         return ResponseHelper.error(res, "Authentication failed: Invalid credentials.", 401);
      59 |     }

      at AuthController.warn [as adminLogin] (src/controllers/admin/auth.controller.js:56:17)
      at Object.adminLogin (test/unit/admin_auth_controller.test.js:65:26)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:48.501Z - [ERROR]: [ERR-MLL7JC8L-H0W] Code: 401 | Message: Authentication failed: Invalid credentials.
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at AuthController.error [as adminLogin] (src/controllers/admin/auth.controller.js:58:31)
      at Object.adminLogin (test/unit/admin_auth_controller.test.js:65:26)

PASS test/unit/branding.test.js
PASS test/unit/vercel_config.test.js
PASS test/unit/pi_network.test.js
  ‚óè Console

    console.error
      [CRITICAL_CONFIG_ERROR] Pi Network API keys are missing in .env!

      53 |  */
      54 | if (!PiConfig.api.apiKey || !PiConfig.api.walletAddress) {
    > 55 |     console.error("[CRITICAL_CONFIG_ERROR] Pi Network API keys are missing in .env!");
         |             ^
      56 | }
      57 |
      58 | export default Object.freeze(PiConfig);

      at error (src/config/pi_network.js:55:13)

PASS test/unit/auth.test.js
  ‚óè Console

    console.log
      [SECURITY_LOG] Authorized Admin access granted at 2026-02-13T18:14:49.309Z

      at log (src/middlewares/auth.middleware.js:33:17)

    console.warn
      [SECURITY_ALERT] Blocked unauthorized Admin attempt from IP: 127.0.0.1

      39 |      * Unauthorized attempts are logged with source metadata for inspection.
      40 |      */
    > 41 |     console.warn(`[SECURITY_ALERT] Blocked unauthorized Admin attempt from IP: ${req.ip}`);
         |             ^
      42 |
      43 |     return res.status(403).json({ 
      44 |         success: false, 

      at warn (src/middlewares/auth.middleware.js:41:13)
      at Object.adminAuth (test/unit/auth.test.js:55:5)

    console.warn
      [SECURITY_ALERT] Blocked unauthorized Admin attempt from IP: 127.0.0.1

      39 |      * Unauthorized attempts are logged with source metadata for inspection.
      40 |      */
    > 41 |     console.warn(`[SECURITY_ALERT] Blocked unauthorized Admin attempt from IP: ${req.ip}`);
         |             ^
      42 |
      43 |     return res.status(403).json({ 
      44 |         success: false, 

      at warn (src/middlewares/auth.middleware.js:41:13)
      at Object.adminAuth (test/unit/auth.test.js:72:5)

PASS test/unit/math.test.js
PASS test/unit/price_service.test.js
PASS test/unit/response_helper.test.js
  ‚óè Console

    console.log
      [32m[AUDIT_INFO] 2026-02-13T18:14:49.543Z - [INFO]: MapCap Audit Engine Synchronized for Cloud Deployment.
      [0m

      at log (src/config/logger.js:58:17)

    console.error
      [31m[AUDIT_ALERT] 2026-02-13T18:14:49.599Z - [ERROR]: [ERR-MLL7JD33-PO8] Code: 400 | Message: Invalid Transaction
      [0m

      54 |     // Critical console output for real-time monitoring via Vercel Logs
      55 |     if (level === 'CRITICAL' || level === 'ERROR' || level === 'WARN') {
    > 56 |         console.error(`\x1b[31m[AUDIT_ALERT] ${entry}\x1b[0m`);
         |                 ^
      57 |     } else {
      58 |         console.log(`\x1b[32m[AUDIT_INFO] ${entry}\x1b[0m`);
      59 |     }

      at error (src/config/logger.js:56:17)
      at ResponseHelper.writeAuditLog [as error] (src/utils/response.helper.js:47:5)
      at Object.error (test/unit/response_helper.test.js:54:20)

PASS test/unit/price.test.js
PASS test/unit/gitignore_policy.test.js
PASS test/unit/mint.test.js
A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.

Summary of all failing tests
FAIL test/unit/package_integrity.test.js
  ‚óè Package Integrity - Production Readiness Tests ‚Ä∫ Metadata: Should have the correct name and stabilized version

    expect(received).toBe(expected) // Object.is equality

    Expected: "1.6.1"
    Received: "1.6.2"

      24 |   test('Metadata: Should have the correct name and stabilized version', () => {
      25 |     expect(pkg.name).toBe('mapcap-ipo-backend');
    > 26 |     expect(pkg.version).toBe('1.6.1');
         |                         ^
      27 |     expect(pkg.type).toBe('module'); // Critical for ES6 imports
      28 |   });
      29 |

      at Object.toBe (test/unit/package_integrity.test.js:26:25)

FAIL test/unit/logger.test.js
  ‚óè Audit Logger Engine - Unit Tests ‚Ä∫ Environment: Should verify logger synchronization message on boot

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "MapCap Audit Engine Synchronized"

    Number of calls: 0

      68 |   test('Environment: Should verify logger synchronization message on boot', () => {
      69 |     // Verification of the initialization log captured during import
    > 70 |     expect(logSpy).toHaveBeenCalledWith(
         |                    ^
      71 |       expect.stringContaining('MapCap Audit Engine Synchronized')
      72 |     );
      73 |   });

      at Object.toHaveBeenCalledWith (test/unit/logger.test.js:70:20)

FAIL test/unit/settlement_logic.test.js
  ‚óè Settlement Job - Anti-Whale Logic Tests ‚Ä∫ Enforcement: Should identify whales and calculate excess Pi with 6-decimal precision

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "Whale_001", 5000.555556
    Received: "Whale_001", 5000.555555

    Number of calls: 1

      62 |     // 2. Verify precise refund calculation using the core MathHelper
      63 |     const expectedRefund = MathHelper.toPiPrecision(5000.5555555);
    > 64 |     expect(PayoutService.executeA2UPayout).toHaveBeenCalledWith('Whale_001', expectedRefund);
         |                                            ^
      65 |
      66 |     // 3. Verify Database Update & Whale Status Flag
      67 |     expect(mockInvestors[0].totalPiContributed).toBe(threshold);

      at Object.toHaveBeenCalledWith (test/unit/settlement_logic.test.js:64:44)

FAIL test/unit/transaction_model.test.js (5.678 s)
  ‚óè Transaction Model - Ledger Integrity Tests ‚Ä∫ Defaults: Should default to COMPLETED status for ledger consistency

    expect(received).toBe(expected) // Object.is equality

    Expected: "COMPLETED"
    Received: "PENDING"

      56 |     });
      57 |
    > 58 |     expect(tx.status).toBe('COMPLETED');
         |                       ^
      59 |   });
      60 |
      61 |   /**

      at Object.toBe (test/unit/transaction_model.test.js:58:23)

FAIL test/unit/server_heartbeat.test.js (8.939 s)
  ‚óè Server Engine - Heartbeat & Integration Tests ‚Ä∫ Resilience: Should trigger the Global Error Interceptor on failures

    expect(received).toHaveProperty(path)

    Expected path: "success"
    Received path: []

    Received value: {}

      69 |      * Ensures the Frontend receives a consistent JSON object even on crashes.
      70 |      */
    > 71 |     expect(res.body).toHaveProperty('success');
         |                      ^
      72 |     expect(res.body.success).toBe(false); // Errors should return success: false
      73 |   });
      74 | });

      at Object.toHaveProperty (test/unit/server_heartbeat.test.js:71:22)


Test Suites: 5 failed, 34 passed, 39 total
Tests:       5 failed, 125 passed, 130 total
Snapshots:   0 total
Time:        19.782 s, estimated 26 s
Ran all test suites.
